<section class="panel">
  <header class="panel__header">
    <h1>Cuentas</h1>
    <input
      [formControl]="q"
      class="input"
      placeholder="Búsqueda rápida por número, tipo o CI cliente..."
    />
  </header>

  <div class="grid">
    <!-- Formulario -->
    <form [formGroup]="form" (ngSubmit)="save()" class="card">
      <h2>{{ form.value.id ? 'Editar' : 'Nueva' }} cuenta</h2>

      <label>
        Número de cuenta
        <input formControlName="number" placeholder="Ej. 478758" />
        <span class="hint" *ngIf="form.controls.number.invalid && form.controls.number.touched">
          Requerido (mín. 4 caracteres)
        </span>
      </label>

      <label>
        Tipo
        <select formControlName="accountType">
          <option value="AHORROS">AHORROS</option>
          <option value="CORRIENTE">CORRIENTE</option>
        </select>
      </label>

      <label>
        Saldo inicial
        <input type="number" formControlName="initialBalance" min="0" step="0.01" />
      </label>

      <label>
        Identificación del cliente
        <input
          formControlName="clientIdentification"
          placeholder="CI del cliente (debe existir en backend)"
        />
        <span
          class="hint"
          *ngIf="
            form.controls.clientIdentification.invalid && form.controls.clientIdentification.touched
          "
        >
          Requerido.
        </span>
      </label>

      <label class="row">
        <input type="checkbox" formControlName="status" />
        <span>Activa</span>
      </label>

      <div class="actions">
        <button type="submit">Guardar</button>
        <button type="button" (click)="clear()">Limpiar</button>
      </div>
      <p class="error" *ngIf="form.invalid && form.touched">Revisa los campos obligatorios.</p>
    </form>

    <!-- Tabla -->
    <div class="card">
      <table class="table">
        <thead>
          <tr>
            <th>Número</th>
            <th>Tipo</th>
            <th>Saldo inicial</th>
            <th>Cliente (CI)</th>
            <th>Estado</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let a of filtered()">
            <td>{{ a.number }}</td>
            <td>{{ a.accountType }}</td>
            <td>{{ a.initialBalance | number : '1.2-2' }}</td>
            <td>{{ a.clientIdentification }}</td>
            <td>
              <span [class.badge-ok]="a.status" [class.badge-no]="!a.status">
                {{ a.status ? 'Activa' : 'Inactiva' }}
              </span>
            </td>
            <td class="row">
              <button (click)="edit(a)">Editar</button>
              <button (click)="remove(a.id)">Eliminar</button>
            </td>
          </tr>
        </tbody>
      </table>

      <div *ngIf="loading()" class="loader">Cargando…</div>
      <div *ngIf="!loading() && filtered().length === 0" class="empty">Sin resultados</div>
    </div>
  </div>
</section>
